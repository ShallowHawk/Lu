# 📱 Android Macrodroid 自动化配置指南

## 概述
通过Macrodroid实现Android手机端自动状态监控，当您切换应用或进入特定状态时，自动向服务器发送状态更新请求。

## 🔧 安装准备

### 1. 安装Macrodroid
- 从Google Play Store下载安装 [MacroDroid](https://play.google.com/store/apps/details?id=com.arlosoft.macrodroid)
- 授予必要权限（应用使用情况、通知权限等）

### 2. 配置服务器地址
将以下内容中的 `YOUR_SERVER_IP` 替换为您的实际服务器IP地址
```
示例: http://192.168.1.100:5000
```

## 🎯 核心宏配置

### 📱 应用启动监控

#### 1. B站/视频类应用
**触发器**: 应用程序启动/前台
- 应用: 哔哩哔哩、抖音、快手、YouTube、爱奇艺
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=4
方法: GET
```

#### 2. 游戏类应用  
**触发器**: 应用程序启动/前台
- 应用: 王者荣耀、和平精英、原神、明日方舟
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=5
方法: GET
```

#### 3. 音乐类应用
**触发器**: 应用程序启动/前台
- 应用: 网易云音乐、QQ音乐、酷狗音乐、Spotify
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=6
方法: GET
```

#### 4. 学习类应用
**触发器**: 应用程序启动/前台
- 应用: 有道词典、百词斩、学习通、钉钉、腾讯会议
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=7
方法: GET
```

### ⏰ 时间触发器

#### 1. 睡眠时间 (22:00)
**触发器**: 时间触发器
- 时间: 22:00
- 重复: 每天
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=1
方法: GET
```

#### 2. 起床时间 (7:00)
**触发器**: 时间触发器
- 时间: 07:00
- 重复: 每天
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=2
方法: GET
```

#### 3. 工作开始 (9:00)
**触发器**: 时间触发器
- 时间: 09:00
- 重复: 工作日
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=2
方法: GET
```

### 🎵 音频状态检测

#### 音乐播放检测
**触发器**: 音频播放状态改变
- 状态: 音频开始播放
**约束条件**: 音频类型 = 音乐
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=6
方法: GET
```

### 🏃‍♀️ 运动状态检测

#### 步数统计触发
**触发器**: 传感器
- 类型: 步数传感器
- 条件: 步数 > 100 (在5分钟内)
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=3
方法: GET
```

### 🔋 设备状态检测

#### 充电状态
**触发器**: 电源状态改变
- 状态: 开始充电
**约束条件**: 时间范围 22:00-06:00
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=1
方法: GET
```

### 📍 位置触发器

#### 到家检测
**触发器**: 位置触发器
- 位置: 家庭位置 (需要预先设置)
- 类型: 进入区域
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=2
方法: GET
```

#### 健身房检测
**触发器**: 位置触发器
- 位置: 健身房位置
- 类型: 进入区域
**动作**: HTTP请求
```
URL: http://YOUR_SERVER_IP:5000/set?secret=birthday2024&status=3
方法: GET
```

## 📲 详细配置步骤

### 创建新宏的步骤：

1. **打开Macrodroid** → 点击 "+" 添加新宏

2. **设置触发器**
   - 选择对应的触发器类型
   - 配置具体参数

3. **添加动作**
   - 选择 "网络" → "HTTP请求"
   - 输入对应的URL
   - 选择GET方法

4. **设置约束条件**（可选）
   - 添加时间范围、电池电量等约束

5. **测试宏**
   - 使用宏编辑器的测试功能验证

6. **启用宏**
   - 确认配置无误后启用

## 🔧 高级配置

### 智能组合触发器

#### 深度睡眠检测
**组合触发器**:
1. 时间 > 23:00
2. 屏幕关闭 > 30分钟
3. 设备静止 (加速度传感器)

**动作**: 设置睡觉状态

### 变量使用

#### 状态持续时间跟踪
```
创建变量: last_status_time
在每个HTTP请求前设置: %last_status_time% = %CURRENT_TIME%
```

### 错误处理

#### 网络连接检查
**约束条件**: 
- WiFi连接状态 = 已连接
- 或移动数据 = 已连接

## 📋 完整宏列表参考

| 应用类型 | 示例应用 | 状态ID | 触发器类型 |
|---------|---------|-------|-----------|
| 视频娱乐 | B站、抖音 | 4 | 应用启动 |
| 游戏娱乐 | 王者、原神 | 5 | 应用启动 |
| 音乐播放 | 网易云 | 6 | 应用启动/音频播放 |
| 学习工作 | 钉钉、学习通 | 7 | 应用启动 |
| 睡眠休息 | 自动 | 1 | 时间/位置/设备状态 |
| 运动健身 | 自动 | 3 | 位置/传感器 |

## 🚨 注意事项

1. **权限设置**: 确保Macrodroid有访问应用使用情况的权限
2. **电池优化**: 将Macrodroid添加到电池优化白名单
3. **网络连接**: 确保手机能访问到您的服务器
4. **测试验证**: 每个宏创建后都要测试确认生效
5. **隐私保护**: 注意个人隐私，避免在公共网络下使用

## 🔄 同步桌面端

如果同时使用桌面端自动监控，建议：
- 手机端优先级更高（使用时间戳比较）
- 或者设置不同的状态更新策略
- 避免频繁的状态切换冲突

---

**🎉 配置完成后，您的Android手机就能自动更新状态啦！** 
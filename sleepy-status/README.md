# 🌟 木头 & 乾雨的智能状态监控系统

一个功能强大的**双人状态监控系统**，支持**自动检测**和**手动控制**两种模式，让朋友们随时了解木头和乾雨在做什么！

## ✨ 功能特性

### 👥 **双人监控系统**（核心特色！）
- **同时监控两人**：支持木头和乾雨的独立状态追踪
- **个性化标识**：每人有独特的emoji和状态显示
- **独立历史记录**：分别记录每人的状态变更历史
- **灵活控制模式**：可选择监控单人或双人

### 🤖 **自动监控模式**
- **桌面应用监控**：自动检测当前使用的应用程序
- **智能状态判断**：根据应用类型自动切换状态
- **时间段识别**：根据时间自动推断可能的状态
- **浏览器智能识别**：根据网页标题判断具体活动
- **用户选择监控**：可选择监控木头或乾雨

### 📱 **手机端控制**
- **双人切换界面**：可在木头和乾雨之间快速切换
- **移动优化界面**：专为手机设计的控制面板
- **一键状态切换**：点击按钮即可更新状态
- **实时同步**：自动刷新显示最新状态
- **触觉反馈**：支持iOS振动反馈

### 🎨 **美观展示**
- **双人状态卡片**：同时展示两人的实时状态
- **毛玻璃设计**：现代化的UI界面
- **在线状态指示**：显示每人的在线/离线状态
- **历史记录追踪**：自动记录状态变更历史
- **跨设备同步**：多设备实时同步状态

## 🏷️ 状态类型

| 状态 | 图标 | 名称 | 描述 | 自动检测 |
|------|------|------|------|----------|
| 1 | 😴 | 睡觉中 | 正在做美梦zzz... | 22:00-6:00 |
| 2 | 💻 | 工作中 | 正在努力工作 | 开发工具、代码编辑器 |
| 3 | 🏃‍♀️ | 运动中 | 正在运动💪 | 手动设置 |
| 4 | 📱 | 看B站 | 正在刷B站 | B站应用、视频播放器 |
| 5 | 🎮 | 玩游戏 | 在游戏世界里 | 游戏应用 |
| 6 | 🎵 | 听音乐 | 正在享受音乐 | 音乐播放器 |
| 7 | 📚 | 学习中 | 在认真学习 | 学习应用、在线课程 |
| 8 | 👩‍🍳 | 做饭中 | 在准备美食 | 手动设置 |
| 9 | ❓ | 未知状态 | 正在使用未知应用 | 自动检测未知应用 |

## 🚀 快速开始

### 方法1：一键启动（推荐）
双击运行 `start_monitor.bat` 文件，选择启动模式即可！

### 方法2：手动启动

#### 环境要求
- Python 3.7+
- Windows 10+（自动监控功能）

#### 安装依赖
```bash
pip install -r requirements.txt
```

#### 启动API服务器
```bash
python app.py
```

#### 启动自动监控（可选）
```bash
python auto_monitor.py
```

## 📱 访问地址

启动成功后，您可以访问：

| 功能 | 地址 | 说明 |
|------|------|------|
| 📱 **双人控制面板** | http://127.0.0.1:5000/mobile | 移动端双人状态控制 |
| 🖥️ **双人状态展示** | http://127.0.0.1:5000/status_page | 桌面端双人状态展示 |
| 📋 **API文档** | http://127.0.0.1:5000 | 接口说明 |

### 📱 手机使用建议
1. **手动控制**: 打开 `http://你的电脑IP:5000/mobile`，添加到主屏幕
2. **自动监控**: 
   - **Android**: 导入 `林璐状态监控.macro` 文件到MacroDroid
   - **iOS**: 按照快捷指令配置指南设置自动化规则

## 🔧 自动监控配置

### 支持的应用程序

#### 💻 **工作相关**
- VS Code (`code.exe`)
- PyCharm (`pycharm64.exe`)
- Visual Studio (`devenv.exe`)
- Cursor (`cursor.exe`)
- Notepad++ (`notepad++.exe`)

#### 🎮 **游戏相关**
- Steam (`steam.exe`)
- 原神 (`genshinimpact.exe`)
- 英雄联盟 (`leagueoflegends.exe`)
- 魔兽世界 (`wow.exe`)

#### 🎵 **音乐相关**
- 网易云音乐 (`cloudmusic.exe`)
- Spotify (`spotify.exe`)
- QQ音乐 (`qqmusic.exe`)

#### 📚 **学习相关**
- Anki (`anki.exe`)
- Obsidian (`obsidian.exe`)
- Notion (`notion.exe`)
- Typora (`typora.exe`)

### 🌐 **浏览器智能识别**
系统会根据网页标题自动判断：
- B站相关页面 → 看B站
- 学习课程页面 → 学习中
- GitHub/技术文档 → 工作中
- 音乐网站 → 听音乐

## 📱 手机端自动化

### 🤖 Android自动化（MacroDroid）

#### 快速导入
1. 安装 [MacroDroid](https://play.google.com/store/apps/details?id=com.arlosoft.macrodroid)
2. 导入配置文件：`mobile_automation/林璐状态监控.macro`
3. 修改配置文件中的 `YOUR_SERVER_IP` 为实际服务器地址
4. 授予应用使用情况和通知权限

#### 支持的自动触发
- **应用启动**: B站、游戏、音乐、学习类应用自动切换状态
- **时间触发**: 22:00睡觉、07:00起床、09:00工作
- **设备状态**: 夜间充电自动睡觉、音乐播放检测
- **运动检测**: 步数传感器检测运动状态

### 🍎 iOS自动化（快捷指令）

#### 配置指南
详见：`mobile_automation/iOS_Shortcuts_Config.md`

#### 主要功能
- **App触发**: 应用启动时自动更新状态
- **时间自动化**: 定时切换状态
- **Siri控制**: 语音命令"我要睡觉了"等
- **位置触发**: 到家、健身房等位置自动切换
- **健康集成**: 体能训练开始时自动切换

### 🔄 跨平台同步
- 桌面端和手机端状态实时同步
- 支持多设备同时使用
- 智能防冲突处理

## 🔐 密钥配置

### 默认密钥
- 密钥：`birthday2024`
- 存储位置：`data.json` 文件

### 修改密钥
编辑 `data.json` 文件：
```json
{
  "secret": "your_new_secret_here",
  ...
}
```

## 📊 API接口

### 查询当前状态
```http
GET /query                    # 获取所有用户状态
GET /query?user=木头          # 获取指定用户状态
GET /query?user=乾雨          # 获取指定用户状态
```

### 设置状态
```http
GET /set?secret=密钥&status=状态ID&user=用户名
# 示例：
GET /set?secret=birthday2024&status=1&user=木头
GET /set?secret=birthday2024&status=2&user=乾雨
```

### 获取状态列表
```http
GET /get/status_list         # 获取所有可用状态
```

### 查看历史记录
```http
GET /history                 # 获取所有用户历史
GET /history?user=木头       # 获取指定用户历史
GET /history?user=乾雨       # 获取指定用户历史
```

## 📁 文件结构

```
sleepy-status/
├── app.py                          # 主API服务器
├── auto_monitor.py                 # 桌面端自动监控脚本
├── start_monitor.bat               # 一键启动脚本
├── requirements.txt                # Python依赖包
├── data.json                       # 配置和当前状态
├── history.json                    # 状态历史记录
├── README.md                       # 使用说明
└── mobile_automation/              # 手机端自动化配置
    ├── Android_Macrodroid_Config.md    # Android配置指南
    ├── iOS_Shortcuts_Config.md         # iOS配置指南
    └── 林璐状态监控.macro              # MacroDroid配置文件
```

## 🛠️ 技术栈

- **后端**: Flask + Flask-CORS
- **自动监控**: psutil + pywin32
- **前端**: 原生 HTML/CSS/JavaScript
- **数据存储**: JSON 文件
- **UI设计**: 毛玻璃风格 + 移动端优化

## 🔄 开机自启动（可选）

如需开机自动启动监控：

1. 按 `Win + R`，输入 `shell:startup`
2. 将 `start_monitor.bat` 的快捷方式复制到启动文件夹
3. 重启电脑即可自动开始监控

## 🆚 对比原项目

相比[原sleepy项目](https://github.com/1812z/sleepy.git)，本项目新增：

✅ **双人监控系统** - 支持木头和乾雨的独立状态追踪  
✅ **个性化用户标识** - 每人专属emoji和显示名称  
✅ **用户切换界面** - 移动端可快速切换监控用户  
✅ **独立历史记录** - 分用户记录状态变更历史  
✅ **Windows原生支持** - 无需额外配置，开箱即用  
✅ **一键启动脚本** - 双击启动，自动检查依赖  
✅ **移动端控制面板** - 专为手机优化的现代化界面  
✅ **Android MacroDroid集成** - 提供完整的`.macro`配置文件  
✅ **iOS快捷指令支持** - 详细的自动化配置指南  
✅ **更多应用程序支持** - 涵盖主流桌面和移动应用  
✅ **时间段智能判断** - 根据作息时间自动推断状态  
✅ **浏览器活动识别** - 智能识别网页内容类型  
✅ **跨平台状态同步** - 桌面端与手机端实时同步  
✅ **现代化UI设计** - 毛玻璃效果+响应式布局

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

---

🎉 **享受智能状态监控带来的便利吧！**